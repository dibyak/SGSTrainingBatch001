!function(e){"use strict";define("DS/WAFData/WAFData",["module","require","DS/Logger/Logger"],function(t,r,o){var n,a={},i=/OPTIONS|GET|HEAD|POST|PUT|PATCH|DELETE|TRACE|CONNECT/i,s=/^((https?|ftp|file):)?\/\//,p=o.getLogger(t),u=e.location&&e.location.protocol?e.location.protocol:"http:",c=null,l=null,d=[e.Blob,e.FormData,e.Int8Array,e.Uint8Array,e.Uint8ClampedArray,e.Int16Array,e.Uint16Array,e.Int32Array,e.Uint32Array,e.Float32Array,e.Float64Array,e.DataView].filter(function(e){return e}),f="access_token",y="x3ds_auth_url",h="x3ds_service_url",m="X-Requested-With",T="xrequestedwith",g="xmlhttprequest",b=/^(async|cors|data|headers|method|onComplete|onFailure|onTimeout|responseType|responseTypeSupport|url|type)$/,x=/^(json|document|blob|arraybuffer|text)$/,C=e.XMLHttpRequest.DONE||4,v=e.XMLHttpRequest.HEADERS_RECEIVED||2;function w(e,t){var r,o=String(t).toLowerCase();for(r in e)if(r.toLowerCase()===o)return r;return!1}function S(e){var t,r,o,n,a,i,s={};if(e)for(i=(e=e.trim()).split("\r\n"),t=0;t<i.length;t++)(r=(a=i[t]).indexOf(": "))>0&&(o=a.substring(0,r),n=a.substring(r+2),s[o]=n);return s}function A(t,r){var o,n,a=r.responseTypeSupport?t.responseType:r.responseType;if(r.responseTypeSupport)if("text"===a||""===a)o=t.responseText;else try{o=t.response}catch(e){n=e,o=null}else"text"===a||""===a||void 0===a?o=t.responseText:"json"===a?o=0===(o=String(t.responseText).trim()).length?null:JSON.parse(o):"document"===a?o=t.responseXML:"arraybuffer"===a?o=function(t){var r,o,n=new e.ArrayBuffer(2*t.length),a=new e.Uint16Array(n);for(r=0,o=t.length;r<o;r++)a[r]=t.charCodeAt(r);return n}(t.responseText):"blob"===a&&(o=new e.Blob([t.responseText],{type:t.getResponseHeader("Content-Type")}));if(null===o&&-1===["json","document"].indexOf(a))throw new Error('InvalidResponseError: request has probably invalid "Content-type" header require by responseType "'+t.responseType+'" causing: "'+n+'".');return o}function P(e){var t,r=["source","subprotocol","protocol","authority","user","password","domain","port","path","directoryPath","fileName","query","anchor"],o=new RegExp("^(?:(?:(?:([^#.:]+):)?([^#.:]+):)?//)?((?:([^:]+)(?::(.*?))?@)?([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(e),n={};for(t=0;t<r.length;t++)n[r[t]]=o[t]||"";return n.subprotocol&&(n.source=n.source.substr(n.subprotocol.length+1)),n.port||(n.port="https"===n.protocol?"443":"80"),n.directoryPath&&n.directoryPath.length>0&&(n.directoryPath=n.directoryPath.replace(/\/?$/,"/")),n.domain=n.domain.toLocaleLowerCase(),n.protocol=n.protocol.toLocaleLowerCase(),n}function E(e,t){var r,o,n=!1,a=s.test(e),i=s.test(t);return a||i?(a?i||(t=R(e,t)):e=R(t,e),r=P(e),o=P(t),n=["domain","protocol","port"].every(function(e){return r[e]===o[e]||"protocol"===e&&(""===r[e]||""===o[e])})):n=!0,n}function R(e,t){if(e=String(e),t=String(t),!s.test(e))throw new Error("First argument should be a absolute URL.");"//"===e.substring(0,2)&&(e=u+e);var r,o,n,a,i=String(e).split("://"),p=i[0],c=i[1].split("/"),l=c[0],d="";if("//"===t.substring(0,2))e=p+":"+t;else if(t.split("://").length>1)e=t;else if("/"===t.substring(0,1))e=p+"://"+l+t;else{for(r=1,o=c.length-1;r<o;r++)d+="/"+c[r];e=p+"://"+l+(a=[],(n=d+"/"+t).replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){"/.."===e?a.pop():a.push(e)}),a.join("").replace(/^\//,"/"===n.charAt(0)?"/":""))}return e}function q(e){return"[object Array]"===Function.prototype.call.bind(Object.prototype.toString)(e)}function O(e){return d.some(function(t){return e instanceof t})}function F(e,t){var r=e.substring(e.indexOf("?")+1).split(/[&;]/),o={};return r.length&&r.forEach(function(e){var r=e.indexOf("=")+1,n=r?e.substr(r):"",a=[e],i=o;r&&(a=t?[e.substr(0,r-1)]:e.substr(0,r-1).match(/([^\]\[]+|(\B)(?=\]))/g)),a&&(n=decodeURIComponent(n),a.forEach(function(e,t){e=decodeURIComponent(e);var r=i[e];t<a.length-1?i=i[e]=r||{}:q(r)?r.push(n):i[e]=r?[r,n]:n}))}),o}function L(e){return encodeURIComponent(e).replace(/\./g,"%2e")}function D(e,t,r){var o,a,i,s,p,u;if("string"==typeof e)s=e;else if(n(e.toQueryString))s=e.toQueryString();else{for(o in s=[],e)e.hasOwnProperty(o)&&(a=e[o],t&&(o=r?t:t+"["+o+"]"),("number"===typeof a?isNaN(a):null==a)||n(a)||(u=void 0,i="function"===(u=typeof(p=a))||"object"===u&&p||q(a)?D(a,o,r):L(o)+"="+L(a)),i&&s.push(i),i=void 0);s=s.join("&")}return s}function j(e,t){p.info("onComplete received: ",e," and headers: ",t)}function U(){p.info("onCancel",arguments)}function I(e,t,r){throw p.warn("onFailure received error: ",e," with content: ",t," and headers: ",r),e}function N(e){p.warn("onTimeout received error: ",e.message)}function H(t,o){var n,a,i,s,u,l,d;if(v===t.readyState)400===t.status&&"arraybuffer"===o.responseType&&(t.responseType="");else if(t.aborted)o.onCancel(t,o);else if(t.timedout)o.onTimeout(new Error("The request has timedout after "+t.timeout+"ms"));else if(C===t.readyState)if(t.timeoutTimer&&clearTimeout(t.timeoutTimer),t.status<=0?-1===["http","https"].indexOf(P(R(e.location,o.url)).protocol):t.status<400){a=S(t.getAllResponseHeaders());try{n=A(t,o)}catch(e){i=e,o.onFailure(e,n,a)}finally{i||o.onComplete(n,a,t)}}else{if(u=""===t.responseType||"text"===t.responseType?t.responseText:String(t.response),s=!1,d=o.onPassportError||c,-1!==[400,401,403].indexOf(t.status))try{l="json"===t.responseType?t.response:JSON.parse(u)}catch(e){l={}}switch(t.status){case 400:l&&"invalid_grant"===l.error&&"string"==typeof l[y]&&(_(l[y],{onComplete:function(e){var t,r,n=JSON.parse(e);n&&n[f]&&n[h]&&(""===(r=P(n[h])).query?r.query="ticket="+n[f]:((t=F(r.query,!0)).ticket=n[f],r.query=D(t,null,!0)),_(function(e){var t="";return e.protocol&&(t=e.protocol+"://",e.subprotocol&&(t=e.subprotocol+":"+t)),e.domain?(t+=e.domain,!e.port||"http"===e.protocol&&80===parseInt(e.port,10)||"https"===e.protocol&&443===parseInt(e.port,10)||(t+=":"+e.port)):e.authority&&(t+=e.authority),e.path&&(t+=e.path),e.query&&(t+="?"+e.query),e.anchor&&(t+="#"+e.anchor),t}(r),o))},onFailure:o.onFailure,onTimeout:o.onTimeout,onPassportError:d,headers:{Accept:"application/json"},withCredentials:!0}),s=!0);break;case 401:(-1!==u.indexOf("Invalid, expired or missing CASTGC")||l&&"invalid_client"===l.error&&"string"==typeof l[y])&&(s=!0,p.error("onReadyStateChange : Passport proxy PGT error, please reload your page"),d&&d(new Error("NetworkError: Invalid, expired or missing CASTGC"),l[y]));break;case 403:"PGT is no more valid"===u?(s=!0,p.error("onReadyStateChange : Lost proxy passport auth session, please reload your page"),d&&d(new Error("NetworkError: PGT is no more valid"))):l&&"license_error"===l.error&&(s=!0,p.error("onReadyStateChange : License is invalid"),"DS/PubSub/PubSub",k("DS/PubSub/PubSub")&&r("DS/PubSub/PubSub").dispatch("license:error"))}if(!s){a=S(t.getAllResponseHeaders());try{n=A(t,o)}catch(e){}o.onFailure(new Error('NetworkError: URL "'+o.url+'" return ResponseCode with value "'+(t.status||0)+'".'),n,a)}}}function k(e){if(r&&r.defined)return r.defined(e);try{return r(e),!0}catch(e){return!1}}function _(t,r){if(!t)throw new Error("Bad or missing URL argument.");var o,n,s=new e.XMLHttpRequest,p=r||{},u=void 0===p.async||!!p.async,c=p.data||null,l=!1===p.cache||p.cache&&p.cache<0,d=p.headers||{},f=p.method||"GET",y=p.type;switch(f=i.test(f)?f.toUpperCase():f,c&&("string"==typeof c||O(c)||(p.data=c=D(c)),"GET"===f&&(t+=(t.indexOf("?")>-1?"&":"?")+c,p.data=c=null)),l&&(t+=(t.indexOf("?")>-1?"&":"?")+"_="+Date.now()),w(d,m)||(E(t,e.location)?d[m]="XMLHttpRequest":F(P(t).query)[T]||(t+=(t.indexOf("?")>-1?"&":"?")+T+"="+g)),s.open(f,t,u),u?p.timeout=void 0!==p.timeout?p.timeout:25e3:delete p.timeout,p.onComplete=p.onComplete||j,p.onCancel=p.onCancel||U,p.onTimeout=p.onTimeout||p.onFailure||N,p.onFailure=p.onFailure||I,p.url=t,y){case"json":w(d,"Accept")||(d.Accept="application/json,text/javascript,*/*");break;case"text":w(d,"Accept")||(d.Accept="text/plain"),p.withCredentials&&-1===d.Accept.indexOf("application/json")&&(d.Accept+=",application/json");break;case"xml":w(d,"Accept")||(d.Accept="application/xml,text/xml,*/*"),void 0===p.responseType&&(p.responseType="document")}for(o in void 0===p.responseType&&x.test(y)&&(p.responseType=y),p.responseTypeSupport="responseType"in s&&"json"!==p.responseType&&(u||"undefined"==typeof window),p)p.hasOwnProperty(o)&&!b.test(o)&&(s[o]=p[o]);if(p.responseTypeSupport)try{s.responseType=p.responseType||"text"}catch(e){s.responseType="text"}if(p.mimeType&&s.overrideMimeType&&s.overrideMimeType(p.mimeType),"POST"!==f||w(d,"Content-Type")||O(c)||(d["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"),s.setRequestHeader)for(n in d)d.hasOwnProperty(n)&&d[n]&&s.setRequestHeader(n,d[n]);return s.addEventListener&&r.onProgress&&s.addEventListener("progress",function(e){r.onProgress(e)}),s.upload&&s.upload.addEventListener&&r.onUploadProgress&&s.upload.addEventListener("progress",function(e){r.onUploadProgress(e)}),s.onreadystatechange=H.bind(a,s,p),p.timeout&&(s.timeoutTimer=setTimeout(function(){s.timedout=!0,s.abort()},p.timeout)),s.send(c),{cancel:function(){s.aborted=!0,s.abort()},xhr:s}}return n="function"!=typeof/./&&"object"!=typeof e.Int8Array?function(e){return"function"==typeof e||!1}:function(e){return"[object Function]"===Function.prototype.call.bind(Object.prototype.toString)(e)},a.setErrorHandler=function(e){e&&(c=e)},a.request=function(e,t){var r,o={};for(r in t=t||{})t.hasOwnProperty(r)&&(o[r]=t[r]);return _(e,o)},a.authenticatedRequest=function(t,o){var n,i=o||{};return null===l&&((l=!(k("DS/PlatformAPI/PlatformAPI")&&"disabled"===String(r("DS/PlatformAPI/PlatformAPI").getApplicationConfiguration("com.3ds.wp.passport.cors"))))||p.info("Passport CORS authentication is not supported")),l||E(t,e.location)?(i.withCredentials=!0,n=a.request(t,i)):k("UWA/Data")?(i.proxy="passport",i.onComplete=i.onComplete||j,i.onCancel=i.onCancel||U,i.onFailure=i.onFailure||I,i.onTimeout=i.onTimeout||I,n=r("UWA/Data").request(t,i)):(i.onFailure||I)(new Error("No CORS support and passport proxy unavailable"),null,{}),n},a.proxifiedRequest=function(e,t){var o,n=t||{};return k("UWA/Data")?(n.proxy=n.proxy||"ajax",n.useJsonpRequest=!1,n.onComplete=n.onComplete||j,n.onCancel=n.onCancel||U,n.onFailure=n.onFailure||I,n.onTimeout=n.onTimeout||I,o=r("UWA/Data").request(e,n)):(n.onFailure||I)(new Error("Proxy unavailable"),null,{}),o},a.handleRequest=function(t,r){return r.authentication&&"passport"===r.authentication?this.authenticatedRequest(t,r):"none"!==r.proxy&&(!E(t,e.location)||r.proxy||r.auth||r.authentication)?this.proxifiedRequest(t,r):this.request(t,r)},a})}(this);